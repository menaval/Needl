<h1>Mes amis</h1>

<div class="container">
  <% current_user.friendships_by_status[:user_friends].each do |friendship| %>
    <div class="friend card-white">
      <div class="row">
        <div class="col-xs-3">
          <%= image_tag friendship[:friendship_user].picture, class: "img-circle" %>
        </div>
        <div class="col-xs-6 infos">
          <h2><%= friendship[:friendship_user].name %></h2>
          <p><%= Recommendation.where(user_id: friendship[:friendship_user]).count %> recos</p>
        </div>
        <div class="col-xs-3">
          <div class="delete">
            <%= link_to "Retirer", friendship_path(friendship[:friendship_relation].id), method: :delete, class: "btn-xs btn-danger"  %>
          </div>
          <div class="visibility">
            <% current_friendship = Friendship.find(friendship[:friendship_relation].id) %>
            <% if ( current_friendship.sender_id == current_user.id && current_friendship.receiver_invisible == true ) || ( current_friendship.receiver_id == current_user.id && current_friendship.sender_invisible == true ) %>
              <%= form_tag visible_friendships_path, method: "post" do %>
                <%= hidden_field_tag :id, value: friendship[:friendship_relation].id %>
                <%= submit_tag "Voir Ã  Nouveau", class: "btn-xs btn-success" %>
              <% end %>
            <% else %>
              <%= form_tag invisible_friendships_path, method: "post" do %>
                <%= hidden_field_tag :id, value: friendship[:friendship_relation].id %>
                <%= submit_tag "Ne plus voir", class: "btn-xs btn-danger" %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>